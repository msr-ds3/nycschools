---
title: "School Placement"
author: "Rivka"
date: "7/25/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(ggplot2)
library(readr)
library(tidyverse)
library(dplyr)
library(readxl)

load('/data/nycdoe/clean_data/common_data_frames/bio_data.Rdata')
```

#Fix school data! dont join on zones. feeder school file is messed up!!!
```{r}
all_bios <- bio_data

#bios_noNA <- all_bios%>% 
 # filter(!is.na(student_id_scram)) #only one student id is na

bios_dbn <- all_bios %>% 
  select(student_id_scram, dbn, year, grade_level)

bios_dbn <- bios_dbn %>% mutate(grade_level = ifelse(grade_level == "0K", "00", grade_level))

#filter out grades before k
bios_dbn <- bios_dbn %>% mutate(grade_level = as.integer(grade_level)) %>% filter(!is.na(grade_level))

#join data so you see students
bios_dbn <- bios_dbn %>% full_join(map_grade, by = c("grade_level" = "grades"))

save(bios_dbn, file = "/data/nycdoe/clean_data/bios_dbn.Rdata")

```
```{r}

placed <- join_zone_bio %>% ungroup() %>% filter(schools == "mid") %>% select(student_id_scram, dbn)
colnames(placed)[2] <- "mid_dbn"

placedhs <- join_zone_bio %>% ungroup() %>% filter(schools == "hs") %>% select(student_id_scram, year, dbn)
colnames(placedhs)[3] <- "hs_dbn"

join_mid_hs <- inner_join(placed, placedhs, by = c("student_id_scram"))

where_students_go_feeder_data <- join_mid_hs %>% group_by(mid_dbn, hs_dbn, year) %>% summarise(count = n())

where_students_go_feeder_data_year <- join_mid_hs %>% group_by(mid_dbn, hs_dbn, year) %>% summarise(count = n())

save(where_students_go_feeder_data_year, file = "/data/nycdoe/clean_data/where_students_go_feeder_year.Rdata")

save(where_students_go_feeder_data, file = "/data/nycdoe/clean_data/where_students_go_feeder.Rdata")
#%>% gather("schooltype","dbn", em, hs, mid) %>% filter(!is.na(dbn)) %>% select(-year)

nrow(placed)

#placed_data <- placed %>% spread(schooltype, dbn)

#placed_data %>% filter(!is.na(em) & !is.na(mid) & !is.na(hs))%>% group_by(student_id_scram) %>% summarise(count = n())


```


See count of students in each middle school DBN
```{r}
placementData %>% group_by(mid) %>% summarise(count = n())
```

```{r}
join_mid_hs %>% group_by(mid_dbn, hs_dbn) %>% summarise(count = n())

```


